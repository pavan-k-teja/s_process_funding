<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>D3 Line Chart with Constrained Drag</title>
  <script src="https://d3js.org/d3.v4.min.js"></script>
</head>
<body>
<svg width="600" height="400"></svg>
<script>
  const svg = d3.select("svg"),
    margin = { top: 20, right: 20, bottom: 30, left: 50 },
    width = +svg.attr("width") - margin.left - margin.right,
    height = +svg.attr("height") - margin.top - margin.bottom;

  const points = [
    [0, height / 2],               // Constrained to the y-axis
    [width / 2, height / 3],       // Freely movable
    [width, 0],                    // Constrained to the x-axis
  ];

  const x = d3.scaleLinear().rangeRound([0, width]);
  const y = d3.scaleLinear().rangeRound([height, 0]);

  const xAxis = d3.axisBottom(x);
  const yAxis = d3.axisLeft(y);

  const line = d3.line()
    .x((d) => x(d[0]))
    .y((d) => y(d[1]));

  const drag = d3.drag()
    .on("start", dragStarted)
    .on("drag", dragged)
    .on("end", dragEnded);

  svg.append("rect")
    .attr("class", "zoom")
    .attr("cursor", "move")
    .attr("fill", "none")
    .attr("pointer-events", "all")
    .attr("width", width)
    .attr("height", height)
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  const focus = svg.append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  x.domain(d3.extent(points, (d) => d[0]));
  y.domain(d3.extent(points, (d) => d[1]));

  focus.append("path")
    .datum(points)
    .attr("fill", "none")
    .attr("stroke", "steelblue")
    .attr("stroke-linejoin", "round")
    .attr("stroke-linecap", "round")
    .attr("stroke-width", 1.5)
    .attr("d", line);

  focus.selectAll("circle")
    .data(points)
    .enter()
    .append("circle")
    .attr("r", 5)
    .attr("cx", (d) => x(d[0]))
    .attr("cy", (d) => y(d[1]))
    .style("cursor", "pointer")
    .style("fill", "steelblue")
    .call(drag);

  focus.append("g")
    .attr("class", "axis axis--x")
    .attr("transform", "translate(0," + height + ")")
    .call(xAxis);

  focus.append("g")
    .attr("class", "axis axis--y")
    .call(yAxis);

  function dragStarted(d) {
    d3.select(this).raise().classed("active", true);
  }

  function dragged(d, i) {
    // Constrain points based on their roles
    if (i === 0) {
      // Constrain point 0 to the y-axis
      d[1] = y.invert(d3.event.y);
      d[0] = 0;
    } else if (i === 2) {
      // Constrain point 2 to the x-axis
      d[0] = x.invert(d3.event.x);
      d[1] = 0;
    } else {
      // Freely movable point
      d[0] = Math.max(0, Math.min(width, x.invert(d3.event.x)));
      d[1] = Math.max(0, Math.min(height, y.invert(d3.event.y)));
    }

    d3.select(this)
      .attr("cx", x(d[0]))
      .attr("cy", y(d[1]));

    focus.select("path").attr("d", line);
  }

  function dragEnded(d) {
    d3.select(this).classed("active", false);
  }
</script>
</body>
</html>
